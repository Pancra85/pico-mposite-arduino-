#include <stdint.h>
#include "graphics.h"

// Tablas precalculadas de seno y coseno con escala 1024 (ángulos 0–359)
const short sinTable[360] = {
    0, 18, 36, 54, 71, 89, 107, 125, 143, 160, 178, 195, 213, 230, 248, 265,
    282, 299, 316, 333, 350, 367, 384, 400, 416, 433, 449, 465, 481, 496, 512, 527,
    543, 558, 573, 587, 602, 616, 630, 644, 658, 672, 685, 698, 711, 724, 737, 749,
    761, 773, 784, 796, 807, 818, 828, 839, 849, 859, 868, 878, 887, 896, 904, 912,
    920, 928, 935, 943, 949, 956, 962, 968, 974, 979, 984, 989, 994, 998, 1002, 1005,
    1008, 1011, 1014, 1016, 1018, 1020, 1022, 1023, 1023, 1024, 1024, 1024, 1023, 1023, 1022, 1020,
    1018, 1016, 1014, 1011, 1008, 1005, 1002, 998, 994, 989, 984, 979, 974, 968, 962, 956,
    949, 943, 935, 928, 920, 912, 904, 896, 887, 878, 868, 859, 849, 839, 828, 818,
    807, 796, 784, 773, 761, 749, 737, 724, 711, 698, 685, 672, 658, 644, 630, 616,
    602, 587, 573, 558, 543, 527, 512, 496, 481, 465, 449, 433, 416, 400, 384, 367,
    350, 333, 316, 299, 282, 265, 248, 230, 213, 195, 178, 160, 143, 125, 107, 89,
    71, 54, 36, 18, 0, -18, -36, -54, -71, -89, -107, -125, -143, -160, -178, -195,
    -213, -230, -248, -265, -282, -299, -316, -333, -350, -367, -384, -400, -416, -433, -449, -465,
    -481, -496, -512, -527, -543, -558, -573, -587, -602, -616, -630, -644, -658, -672, -685, -698,
    -711, -724, -737, -749, -761, -773, -784, -796, -807, -818, -828, -839, -849, -859, -868, -878,
    -887, -896, -904, -912, -920, -928, -935, -943, -949, -956, -962, -968, -974, -979, -984, -989,
    -994, -998, -1002, -1005, -1008, -1011, -1014, -1016, -1018, -1020, -1022, -1023, -1023, -1024, -1024, -1024,
    -1023, -1023, -1022, -1020, -1018, -1016, -1014, -1011, -1008, -1005, -1002, -998, -994, -989, -984, -979,
    -974, -968, -962, -956, -949, -943, -935, -928, -920, -912, -904, -896, -887, -878, -868, -859,
    -849, -839, -828, -818, -807, -796, -784, -773, -761, -749, -737, -724, -711, -698, -685, -672,
    -658, -644, -630, -616, -602, -587, -573, -558, -543, -527, -512, -496, -481, -465, -449, -433,
    -416, -400, -384, -367, -350, -333, -316, -299, -282, -265, -248, -230, -213, -195, -178, -160,
    -143, -125, -107, -89, -71, -54, -36, -18};
const short cosTable[360] = {
    1024, 1024, 1023, 1023, 1022, 1020, 1018, 1016, 1014, 1011, 1008, 1005, 1002, 998, 994, 989,
    984, 979, 974, 968, 962, 956, 949, 943, 935, 928, 920, 912, 904, 896, 887, 878,
    868, 859, 849, 839, 828, 818, 807, 796, 784, 773, 761, 749, 737, 724, 711, 698,
    685, 672, 658, 644, 630, 616, 602, 587, 573, 558, 543, 527, 512, 496, 481, 465,
    449, 433, 416, 400, 384, 367, 350, 333, 316, 299, 282, 265, 248, 230, 213, 195,
    178, 160, 143, 125, 107, 89, 71, 54, 36, 18, 0, -18, -36, -54, -71, -89,
    -107, -125, -143, -160, -178, -195, -213, -230, -248, -265, -282, -299, -316, -333, -350, -367,
    -384, -400, -416, -433, -449, -465, -481, -496, -512, -527, -543, -558, -573, -587, -602, -616,
    -630, -644, -658, -672, -685, -698, -711, -724, -737, -749, -761, -773, -784, -796, -807, -818,
    -828, -839, -849, -859, -868, -878, -887, -896, -904, -912, -920, -928, -935, -943, -949, -956,
    -962, -968, -974, -979, -984, -989, -994, -998, -1002, -1005, -1008, -1011, -1014, -1016, -1018, -1020,
    -1022, -1023, -1023, -1024, -1024, -1024, -1023, -1023, -1022, -1020, -1018, -1016, -1014, -1011, -1008, -1005,
    -1002, -998, -994, -989, -984, -979, -974, -968, -962, -956, -949, -943, -935, -928, -920, -912,
    -904, -896, -887, -878, -868, -859, -849, -839, -828, -818, -807, -796, -784, -773, -761, -749,
    -737, -724, -711, -698, -685, -672, -658, -644, -630, -616, -602, -587, -573, -558, -543, -527,
    -512, -496, -481, -465, -449, -433, -416, -400, -384, -367, -350, -333, -316, -299, -282, -265,
    -248, -230, -213, -195, -178, -160, -143, -125, -107, -89, -71, -54, -36, -18, 0, 18,
    36, 54, 71, 89, 107, 125, 143, 160, 178, 195, 213, 230, 248, 265, 282, 299,
    316, 333, 350, 367, 384, 400, 416, 433, 449, 465, 481, 496, 512, 527, 543, 558,
    573, 587, 602, 616, 630, 644, 658, 672, 685, 698, 711, 724, 737, 749, 761, 773,
    784, 796, 807, 818, 828, 839, 849, 859, 868, 878, 887, 896, 904, 912, 920, 928,
    935, 943, 949, 956, 962, 968, 974, 979, 984, 989, 994, 998, 1002, 1005, 1008, 1011,
    1014, 1016, 1018, 1020, 1022, 1023, 1023, 1024};
// sqrt(x / 255.0) escalado por 255
const uint8_t sqrtLut[256] = {
    0, 15, 22, 27, 31, 35, 39, 42, 45, 47, 50, 52, 55, 57, 59, 61,
    63, 65, 67, 69, 71, 73, 74, 76, 78, 79, 81, 82, 84, 85, 87, 88,
    90, 91, 93, 94, 95, 97, 98, 99, 100, 102, 103, 104, 105, 107, 108, 109,
    110, 111, 112, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126,
    127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 141,
    142, 143, 144, 145, 146, 147, 148, 148, 149, 150, 151, 152, 153, 153, 154, 155,
    156, 157, 158, 158, 159, 160, 161, 162, 162, 163, 164, 165, 165, 166, 167, 168,
    168, 169, 170, 171, 171, 172, 173, 174, 174, 175, 176, 177, 177, 178, 179, 179,
    180, 181, 182, 182, 183, 184, 184, 185, 186, 186, 187, 188, 188, 189, 190, 190,
    191, 192, 192, 193, 194, 194, 195, 196, 196, 197, 198, 198, 199, 200, 200, 201,
    201, 202, 203, 203, 204, 205, 205, 206, 206, 207, 208, 208, 209, 210, 210, 211,
    211, 212, 213, 213, 214, 214, 215, 216, 216, 217, 217, 218, 218, 219, 220, 220,
    221, 221, 222, 222, 223, 224, 224, 225, 225, 226, 226, 227, 228, 228, 229, 229,
    230, 230, 231, 231, 232, 233, 233, 234, 234, 235, 235, 236, 236, 237, 237, 238,
    238, 239, 240, 240, 241, 241, 242, 242, 243, 243, 244, 244, 245, 245, 246, 246,
    247, 247, 248, 248, 249, 249, 250, 250, 251, 251, 252, 252, 253, 253, 254, 255};

// # Generar tablas sinLut y cosLut con escala 256
//  sinLut = [round(math.sin(math.radians(a)) * 256) for a in range(360)]
//  cosLut = [round(math.cos(math.radians(a)) * 256) for a in range(360)]
const short sinLut[360] = {
    0, 4, 9, 13, 18, 22, 27, 31, 36, 40,
    44, 49, 53, 58, 62, 66, 71, 75, 79, 83,
    88, 92, 96, 100, 104, 108, 112, 116, 120, 124,
    128, 132, 136, 139, 143, 147, 150, 154, 158, 161,
    165, 168, 171, 175, 178, 181, 184, 187, 190, 193,
    196, 199, 202, 204, 207, 210, 212, 215, 217, 219,
    222, 224, 226, 228, 230, 232, 234, 236, 237, 239,
    241, 242, 243, 245, 246, 247, 248, 249, 250, 251,
    252, 253, 254, 254, 255, 255, 255, 255, 255, 255,
    255, 255, 255, 255, 255, 255, 255, 254, 254, 253,
    252, 251, 250, 249, 248, 247, 246, 245, 243, 242,
    241, 239, 237, 236, 234, 232, 230, 228, 226, 224,
    222, 219, 217, 215, 212, 210, 207, 204, 202, 199,
    196, 193, 190, 187, 184, 181, 178, 175, 171, 168,
    165, 161, 158, 154, 150, 147, 143, 139, 136, 132,
    128, 124, 120, 116, 112, 108, 104, 100, 96, 92,
    88, 83, 79, 75, 71, 66, 62, 58, 53, 49,
    44, 40, 36, 31, 27, 22, 18, 13, 9, 4,
    0, -4, -9, -13, -18, -22, -27, -31, -36, -40,
    -44, -49, -53, -58, -62, -66, -71, -75, -79, -83,
    -88, -92, -96, -100, -104, -108, -112, -116, -120, -124,
    -128, -132, -136, -139, -143, -147, -150, -154, -158, -161,
    -165, -168, -171, -175, -178, -181, -184, -187, -190, -193,
    -196, -199, -202, -204, -207, -210, -212, -215, -217, -219,
    -222, -224, -226, -228, -230, -232, -234, -236, -237, -239,
    -241, -242, -243, -245, -246, -247, -248, -249, -250, -251,
    -252, -253, -254, -254, -255, -255, -255, -255, -255, -255,
    -255, -255, -255, -255, -255, -255, -255, -254, -254, -253,
    -252, -251, -250, -249, -248, -247, -246, -245, -243, -242,
    -241, -239, -237, -236, -234, -232, -230, -228, -226, -224,
    -222, -219, -217, -215, -212, -210, -207, -204, -202, -199,
    -196, -193, -190, -187, -184, -181, -178, -175, -171, -168,
    -165, -161, -158, -154, -150, -147, -143, -139, -136, -132,
    -128, -124, -120, -116, -112, -108, -104, -100, -96, -92,
    -88, -83, -79, -75, -71, -66, -62, -58, -53, -49,
    -44, -40, -36, -31, -27, -22, -18, -13, -9, -4};

const short cosLut[360] = {
    256, 256, 256, 256, 256, 255, 255, 254, 254, 253,
    252, 251, 250, 249, 248, 246, 245, 244, 243, 241,
    240, 238, 236, 235, 233, 231, 229, 227, 225, 223,
    221, 219, 217, 214, 212, 210, 207, 204, 202, 199,
    196, 193, 190, 187, 184, 181, 178, 175, 171, 168,
    165, 161, 158, 154, 150, 147, 143, 139, 136, 132,
    128, 124, 120, 116, 112, 108, 104, 100, 96, 92,
    88, 83, 79, 75, 71, 66, 62, 58, 53, 49,
    44, 40, 36, 31, 27, 22, 18, 13, 9, 4,
    0, -4, -9, -13, -18, -22, -27, -31, -36, -40,
    -44, -49, -53, -58, -62, -66, -71, -75, -79, -83,
    -88, -92, -96, -100, -104, -108, -112, -116, -120, -124,
    -128, -132, -136, -139, -143, -147, -150, -154, -158, -161,
    -165, -168, -171, -175, -178, -181, -184, -187, -190, -193,
    -196, -199, -202, -204, -207, -210, -212, -214, -217, -219,
    -221, -223, -225, -227, -229, -231, -233, -235, -236, -238,
    -240, -241, -243, -244, -245, -246, -248, -249, -250, -251,
    -252, -253, -254, -254, -255, -255, -256, -256, -256, -256,
    -256, -256, -256, -255, -255, -254, -254, -253, -252, -251,
    -250, -249, -248, -246, -245, -244, -243, -241, -240, -238,
    -236, -235, -233, -231, -229, -227, -225, -223, -221, -219,
    -217, -214, -212, -210, -207, -204, -202, -199, -196, -193,
    -190, -187, -184, -181, -178, -175, -171, -168, -165, -161,
    -158, -154, -150, -147, -143, -139, -136, -132, -128, -124,
    -120, -116, -112, -108, -104, -100, -96, -92, -88, -83,
    -79, -75, -71, -66, -62, -58, -53, -49, -44, -40,
    -36, -31, -27, -22, -18, -13, -9, -4, 0, 4,
    9, 13, 18, 22, 27, 31, 36, 40, 44, 49,
    53, 58, 62, 66, 71, 75, 79, 83, 88, 92,
    96, 100, 104, 108, 112, 116, 120, 124, 128, 132,
    136, 139, 143, 147, 150, 154, 158, 161, 165, 168,
    171, 175, 178, 181, 184, 187, 190, 193, 196, 199,
    202, 204, 207, 210, 212, 214, 217, 219, 221, 223,
    225, 227, 229, 231, 233, 235, 236, 238, 240, 241,
    243, 244, 245, 246, 248, 249, 250, 251, 252, 253,
    254, 254, 255, 255, 256, 256, 256, 256, 256, 256};

    // Define the Bayer 8x8 matrix (for dithering)
const int bayerMatrix[BAYER_MATRIX_SIZE][BAYER_MATRIX_SIZE] = {
    {0, 32, 8, 40, 2, 34, 10, 42},
    {48, 16, 56, 24, 50, 18, 58, 26},
    {12, 44, 4, 36, 14, 46, 6, 38},
    {60, 28, 52, 20, 62, 30, 54, 22},
    {3, 35, 11, 43, 1, 33, 9, 41},
    {51, 19, 59, 27, 49, 17, 57, 25},
    {15, 47, 7, 39, 13, 45, 5, 37},
    {63, 31, 55, 23, 61, 29, 53, 21}};

const int bayerMatrixY[BAYER_MATRIX_SIZE] = {54, 18, 36, 0, 63, 27, 45, 9};